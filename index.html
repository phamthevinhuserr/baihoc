<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Luyện thi Sinh học 12 – Ôn tập HKI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Tối ưu tốc độ hiển thị và hiệu ứng */
    :root { color-scheme: dark; }
    body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
    
    /* Animation nhẹ cho chuyển động mượt mà */
    .fade-in { animation: fadeIn 0.3s ease-in-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #1e293b; }
    ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #64748b; }

    /* Utility classes cho trạng thái nút */
    .btn-option { transition: all 0.2s; border: 1px solid #334155; }
    .btn-option:hover:not(:disabled) { background-color: #334155; border-color: #475569; }
    
    /* Màu sắc trạng thái */
    .correct { background-color: #059669 !important; border-color: #059669 !important; color: white !important; }
    .wrong { background-color: #e11d48 !important; border-color: #e11d48 !important; color: white !important; }
    .neutral { background-color: #1e293b; color: #e2e8f0; }
  </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen flex flex-col items-center justify-center p-4">

<div class="w-full max-w-4xl bg-slate-900/50 backdrop-blur-md border border-slate-800 rounded-3xl shadow-2xl overflow-hidden min-h-[500px] flex flex-col relative">
  
  <div class="bg-slate-900/80 border-b border-slate-800 p-5 flex justify-between items-center z-10">
    <div>
      <h1 class="text-xl font-bold text-indigo-400 tracking-tight">SINH HỌC 12</h1>
      <p class="text-xs text-slate-400 mt-1">Ôn tập trắc nghiệm • Đúng sai • Trả lời ngắn</p>
    </div>
    <div id="topControls" class="hidden">
       <button onclick="backToMenu()" class="text-sm font-medium text-slate-400 hover:text-white transition flex items-center gap-1">
         <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
         Thoát
       </button>
    </div>
  </div>

  <div class="flex-1 p-6 relative overflow-y-auto" id="mainContent">
    
    <div id="menuView" class="fade-in h-full flex flex-col justify-center">
      <h2 class="text-2xl font-bold text-center mb-8">Chọn phần thi</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <button onclick="startQuiz('I')" class="group relative p-6 bg-slate-800 rounded-2xl hover:bg-indigo-900/30 border border-slate-700 hover:border-indigo-500 transition-all text-left">
          <div class="absolute top-4 right-4 w-8 h-8 rounded-full bg-indigo-500/20 text-indigo-400 flex items-center justify-center font-bold text-sm">I</div>
          <h3 class="text-lg font-bold text-indigo-300 group-hover:text-indigo-200">Trắc nghiệm</h3>
          <p class="text-sm text-slate-400 mt-2">Chọn 1 đáp án đúng trong 4 phương án.</p>
        </button>

        <button onclick="startQuiz('II')" class="group relative p-6 bg-slate-800 rounded-2xl hover:bg-emerald-900/30 border border-slate-700 hover:border-emerald-500 transition-all text-left">
          <div class="absolute top-4 right-4 w-8 h-8 rounded-full bg-emerald-500/20 text-emerald-400 flex items-center justify-center font-bold text-sm">II</div>
          <h3 class="text-lg font-bold text-emerald-300 group-hover:text-emerald-200">Đúng / Sai</h3>
          <p class="text-sm text-slate-400 mt-2">Xác định tính đúng sai của 4 ý trong mỗi câu.</p>
        </button>

        <button onclick="startQuiz('III')" class="group relative p-6 bg-slate-800 rounded-2xl hover:bg-rose-900/30 border border-slate-700 hover:border-rose-500 transition-all text-left">
          <div class="absolute top-4 right-4 w-8 h-8 rounded-full bg-rose-500/20 text-rose-400 flex items-center justify-center font-bold text-sm">III</div>
          <h3 class="text-lg font-bold text-rose-300 group-hover:text-rose-200">Trả lời ngắn</h3>
          <p class="text-sm text-slate-400 mt-2">Điền số hoặc từ khóa ngắn gọn.</p>
        </button>
      </div>
    </div>

    <div id="quizView" class="hidden h-full flex flex-col">
      <div class="w-full bg-slate-800 h-1.5 rounded-full mb-6 overflow-hidden">
        <div id="progressBar" class="bg-indigo-500 h-1.5 rounded-full transition-all duration-300" style="width: 0%"></div>
      </div>

      <div class="flex-1 fade-in">
        <div class="flex justify-between items-end mb-4">
           <span class="text-sm font-semibold text-indigo-400 uppercase tracking-wider" id="qTypeLabel">PHẦN I</span>
           <span class="text-2xl font-bold text-slate-600 select-none" id="qIndexDisplay">01</span>
        </div>
        
        <h3 id="qText" class="text-xl md:text-2xl font-medium leading-relaxed mb-6 text-slate-100"></h3>
        
        <div id="answerArea" class="space-y-3"></div>
        
        <div id="feedbackBox" class="hidden mt-6 p-4 rounded-xl bg-slate-800/50 border border-slate-700"></div>
      </div>

      <div class="mt-8 flex justify-between items-center pt-4 border-t border-slate-800/50">
        <button onclick="navigate(-1)" id="btnPrev" class="px-5 py-2.5 rounded-xl bg-slate-800 hover:bg-slate-700 text-slate-300 transition disabled:opacity-30 disabled:cursor-not-allowed">
          ← Quay lại
        </button>
        <button onclick="navigate(1)" id="btnNext" class="px-5 py-2.5 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white font-medium shadow-lg shadow-indigo-500/20 transition disabled:opacity-30">
          Câu tiếp theo →
        </button>
      </div>
    </div>

  </div>
</div>

<script>
/* ================= DỮ LIỆU CÂU HỎI (DATA) ================= */
// Bạn có thể copy thêm câu hỏi vào đây theo đúng mẫu

const dataPart1 = [
  { q: "Một đoạn DNA mang thông tin mã hóa cho chuỗi polypeptide được gọi là gì?", opts: ["Codon", "Gene", "Anticodon", "Mã di truyền"], a: 1 }, // Index 1 là Gene (0,1,2,3)
  { q: "Các base nitơ của RNA gồm những loại nào?", opts: ["A, C, T, G", "A, C, U, G", "A, C, U, T", "C, U, T, G"], a: 1 },
  { q: "Bộ ba 3’AAT5’ trên mạch gốc sẽ phiên mã thành codon nào trên mRNA?", opts: ["AAU", "UUA", "5’UUA3’", "5’AAU3’"], a: 2 },
  { q: "Trong các codon sau, codon nào mã hóa cho amino acid?", opts: ["UAA", "UAG", "GCC", "UGA"], a: 2 },
  { q: "Đặc điểm AUG chỉ mã hóa cho Methionine ở sinh vật nhân thực thể hiện tính chất nào của mã di truyền?", opts: ["Tính đặc hiệu", "Tính thoái hóa", "Tính phổ biến", "Tính liên tục"], a: 0 },
];

const dataPart2 = [
  { 
    q: "Nhận định về quá trình phiên mã ở sinh vật nhân thực:", 
    items: [
      { t: "Có sự tham gia của enzyme RNA polymerase", a: true },
      { t: "Chỉ tạo ra duy nhất một loại mRNA từ một gene", a: false },
      { t: "Luôn diễn ra sự cắt nối exon – intron (ở gene phân mảnh)", a: true },
      { t: "Quá trình này diễn ra chủ yếu trong tế bào chất", a: false }
    ]
  },
  {
    q: "Về hoạt động của Operon Lac ở vi khuẩn E. coli:",
    items: [
      { t: "Lactose đóng vai trò là chất cảm ứng", a: true },
      { t: "Protein ức chế gắn vào vùng vận hành (O) khi môi trường có lactose", a: false },
      { t: "Gene Z mã hóa enzyme phân giải đường lactose", a: true },
      { t: "Cơ chế này cũng tìm thấy phổ biến ở sinh vật nhân thực đa bào", a: false }
    ]
  }
];

const dataPart3 = [
  { q: "Có bao nhiêu thành phần tham gia trực tiếp vào quá trình dịch mã (mRNA, tRNA, Ribosome, Acid amin)?", a: "4" },
  { q: "Đột biến điểm dạng thay thế 1 cặp nucleotide liên quan đến bao nhiêu cặp nucleotide?", a: "1" },
  { q: "Một loài có bộ NST 2n = 8. Thể một (2n-1) của loài này có bao nhiêu nhiễm sắc thể?", a: "7" }
];

/* ================= LOGIC ỨNG DỤNG ================= */

let currentPart = '';
let currentQuestions = [];
let currentIndex = 0;
// Lưu trữ trạng thái làm bài: { [index]: user_answer }
let userState = {}; 

const menuView = document.getElementById('menuView');
const quizView = document.getElementById('quizView');
const topControls = document.getElementById('topControls');

// --- HÀM ĐIỀU HƯỚNG ---

function startQuiz(part) {
  currentPart = part;
  currentIndex = 0;
  userState = {}; // Reset trạng thái khi bắt đầu mới
  
  // Chọn data tương ứng
  if (part === 'I') currentQuestions = dataPart1;
  else if (part === 'II') currentQuestions = dataPart2;
  else currentQuestions = dataPart3;

  // Chuyển màn hình
  menuView.classList.add('hidden');
  quizView.classList.remove('hidden');
  topControls.classList.remove('hidden');
  
  renderQuestion();
}

function backToMenu() {
  if(confirm("Bạn có chắc muốn thoát? Kết quả hiện tại sẽ mất.")){
    quizView.classList.add('hidden');
    topControls.classList.add('hidden');
    menuView.classList.remove('hidden');
  }
}

function navigate(direction) {
  const newIndex = currentIndex + direction;
  if (newIndex >= 0 && newIndex < currentQuestions.length) {
    currentIndex = newIndex;
    renderQuestion();
  }
}

// --- HÀM RENDER CHÍNH ---

function renderQuestion() {
  const q = currentQuestions[currentIndex];
  
  // Update UI Header
  document.getElementById('qTypeLabel').innerText = `PHẦN ${currentPart}`;
  document.getElementById('qIndexDisplay').innerText = `${currentIndex + 1}/${currentQuestions.length}`;
  document.getElementById('progressBar').style.width = `${((currentIndex + 1) / currentQuestions.length) * 100}%`;
  
  // Update Content
  const qTextEl = document.getElementById('qText');
  const ansArea = document.getElementById('answerArea');
  const feedbackBox = document.getElementById('feedbackBox');
  
  qTextEl.innerText = q.q;
  ansArea.innerHTML = '';
  feedbackBox.classList.add('hidden'); // Ẩn feedback khi chuyển câu
  
  // Disable nút Prev/Next nếu cần
  document.getElementById('btnPrev').disabled = (currentIndex === 0);
  document.getElementById('btnNext').disabled = (currentIndex === currentQuestions.length - 1);

  // Hiệu ứng fade nhẹ
  qTextEl.parentElement.classList.remove('fade-in');
  void qTextEl.parentElement.offsetWidth; // trigger reflow
  qTextEl.parentElement.classList.add('fade-in');

  // RENDER THEO TỪNG LOẠI
  if (currentPart === 'I') renderPart1(q, ansArea);
  else if (currentPart === 'II') renderPart2(q, ansArea);
  else renderPart3(q, ansArea);
}

// --- RENDER PHẦN I (TRẮC NGHIỆM) ---
function renderPart1(q, container) {
  const savedAns = userState[currentIndex]; // Lấy đáp án đã chọn (nếu có)
  const isAnswered = savedAns !== undefined;

  q.opts.forEach((opt, idx) => {
    const btn = document.createElement('button');
    btn.className = `w-full text-left p-4 rounded-xl bg-slate-800 border border-slate-700 hover:bg-slate-700 transition flex items-center gap-3`;
    
    // Logic màu sắc
    if (isAnswered) {
      if (idx === q.a) {
        btn.classList.add('correct'); // Đáp án đúng luôn xanh
      } else if (idx === savedAns && savedAns !== q.a) {
        btn.classList.add('wrong'); // Chọn sai thì đỏ
      } else {
        btn.classList.add('opacity-50'); // Các câu còn lại mờ đi
      }
      btn.disabled = true;
    }

    btn.innerHTML = `
      <span class="flex-shrink-0 w-8 h-8 rounded-full border border-current flex items-center justify-center font-bold text-sm">
        ${String.fromCharCode(65 + idx)}
      </span>
      <span>${opt}</span>
    `;
    
    if (!isAnswered) {
      btn.onclick = () => handleAnswerPart1(idx);
    }
    
    container.appendChild(btn);
  });
}

function handleAnswerPart1(selectedIndex) {
  userState[currentIndex] = selectedIndex; // Lưu trạng thái
  renderQuestion(); // Re-render để hiện màu
}

// --- RENDER PHẦN II (ĐÚNG/SAI) ---
function renderPart2(q, container) {
  // Container cho bảng đúng sai
  const table = document.createElement('div');
  table.className = "space-y-4";
  
  if (!userState[currentIndex]) userState[currentIndex] = {}; // Init object lưu 4 ý

  q.items.forEach((item, idx) => {
    const rowState = userState[currentIndex][idx]; // null, true, or false (lựa chọn của user)
    const isRowDone = rowState !== undefined;

    const row = document.createElement('div');
    row.className = "p-4 rounded-xl bg-slate-800/50 border border-slate-700 flex flex-col sm:flex-row sm:items-center justify-between gap-4";
    
    // Text nội dung
    const textDiv = document.createElement('div');
    textDiv.className = "flex-1 text-slate-200";
    textDiv.innerText = `${idx + 1}. ${item.t}`;
    
    // Button Group
    const btnGroup = document.createElement('div');
    btnGroup.className = "flex gap-2 shrink-0";

    // Nút ĐÚNG
    const btnTrue = createTFBtn(true, item.a, rowState);
    const btnFalse = createTFBtn(false, item.a, rowState);

    // Logic click
    if (!isRowDone) {
      btnTrue.onclick = () => handleAnswerPart2(idx, true);
      btnFalse.onclick = () => handleAnswerPart2(idx, false);
    } else {
        btnTrue.disabled = true;
        btnFalse.disabled = true;
    }

    btnGroup.append(btnTrue, btnFalse);
    row.append(textDiv, btnGroup);
    table.appendChild(row);
  });
  
  container.appendChild(table);
}

// Helper tạo nút Đúng/Sai
function createTFBtn(isBtnTrue, correctAnswer, userChoice) {
  const btn = document.createElement('button');
  const label = isBtnTrue ? "Đúng" : "Sai";
  
  // Style cơ bản
  btn.className = "px-4 py-1.5 rounded-lg border text-sm font-semibold transition-all min-w-[70px] ";
  
  if (userChoice === undefined) {
    // Chưa chọn
    btn.className += "bg-slate-700 border-slate-600 hover:bg-slate-600 text-slate-300";
  } else {
    // Đã chọn
    if (userChoice === isBtnTrue) {
      // Đây là nút người dùng đã bấm
      if (userChoice === correctAnswer) {
        btn.className += "bg-emerald-600 border-emerald-500 text-white shadow-[0_0_10px_rgba(16,185,129,0.4)]"; // Chọn đúng
      } else {
        btn.className += "bg-rose-600 border-rose-500 text-white"; // Chọn sai
      }
    } else {
      // Nút người dùng KHÔNG bấm
      // Nếu nút này là đáp án đúng (mà người dùng không bấm), hiện viền xanh gợi ý
      if (isBtnTrue === correctAnswer) {
         btn.className += "bg-transparent border-emerald-500 text-emerald-500 opacity-60";
      } else {
         btn.className += "bg-transparent border-slate-700 text-slate-600 opacity-30";
      }
    }
  }
  
  btn.innerText = label;
  return btn;
}

function handleAnswerPart2(itemIdx, choice) {
  userState[currentIndex][itemIdx] = choice;
  renderQuestion();
}

// --- RENDER PHẦN III (TRẢ LỜI NGẮN) ---
function renderPart3(q, container) {
  const savedVal = userState[currentIndex];
  const isDone = savedVal !== undefined;

  const wrapper = document.createElement('div');
  
  const input = document.createElement('input');
  input.type = "text";
  input.className = "w-full p-4 text-lg rounded-xl bg-slate-950 border border-slate-700 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none transition";
  input.placeholder = "Nhập đáp án của bạn...";
  if (isDone) {
    input.value = savedVal;
    input.disabled = true;
    // Kiểm tra đúng sai để style input
    if (normalize(savedVal) == normalize(q.a)) {
        input.classList.add("border-emerald-500", "text-emerald-400");
    } else {
        input.classList.add("border-rose-500", "text-rose-400");
    }
  }

  const btnSubmit = document.createElement('button');
  btnSubmit.className = "mt-4 btn px-6 py-3 bg-indigo-600 hover:bg-indigo-500 rounded-xl text-white font-semibold transition disabled:hidden";
  btnSubmit.innerText = "Trả lời";
  btnSubmit.onclick = () => {
    const val = input.value.trim();
    if(!val) return;
    userState[currentIndex] = val;
    renderQuestion();
  };

  if (isDone) btnSubmit.classList.add('hidden');

  wrapper.append(input, btnSubmit);
  container.appendChild(wrapper);

  // Hiển thị feedback ngay lập tức nếu đã làm
  if (isDone) {
    const fb = document.getElementById('feedbackBox');
    fb.classList.remove('hidden');
    const isCorrect = normalize(savedVal) == normalize(q.a);
    fb.className = `mt-6 p-4 rounded-xl border ${isCorrect ? 'border-emerald-500/30 bg-emerald-900/10' : 'border-rose-500/30 bg-rose-900/10'}`;
    fb.innerHTML = isCorrect 
      ? `<div class="flex items-center gap-2 text-emerald-400 font-bold"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> Chính xác!</div>`
      : `<div class="text-rose-400 font-bold mb-1">Sai rồi</div><div class="text-slate-300">Đáp án đúng là: <span class="font-mono font-bold text-white">${q.a}</span></div>`;
  }
}

function normalize(str) {
  // Hàm chuẩn hóa chuỗi để so sánh (bỏ khoảng trắng, viết thường)
  return String(str).toLowerCase().replace(/\s+/g, '');
}

</script>
</body>
</html>
